<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>



  <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>


    <meta name="description" content="Chandler's Blog" />



  <meta name="keywords" content="Hexo,next" />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description" content="Chandler&apos;s Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Amateur Programming">
<meta property="og:url" content="http://github.com/ttma1046/page/2/index.html">
<meta property="og:site_name" content="Amateur Programming">
<meta property="og:description" content="Chandler&apos;s Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Amateur Programming">
<meta name="twitter:description" content="Chandler&apos;s Blog">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post'
  };
</script>

  <title> Amateur Programming </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">Amateur Programming</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            Tags
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 
  <section id="posts" class="posts-expand">
    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/06/20/sublimeshortcuts/" itemprop="url">
                Sublime Shortcuts.
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-06-20T01:17:48+00:00" content="2016-06-20">
            2016-06-20
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">hot_exit</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">  "<span class="attribute">remember_open_files</span>": <span class="value"><span class="literal">false</span></span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>It’s usually just easier to skip the mouse altogether—or it would be if Sublime didn’t mess up multiselect when word wrapping.  Here’s the official documentation on using the <a href="http://www.sublimetext.com/docs/2/multiple_selection_with_the_keyboard.html" target="_blank" rel="external">keyboard</a> and <a href="http://www.sublimetext.com/docs/selection" target="_blank" rel="external">mouse</a> for multiple selection.  Since it’s a bit spread out, I’ll summarize it:</p>

<p>Where shortcuts are different in Sublime Text 3, I’ve made a note.  For v3, I always test using the latest dev build; if you’re using the beta build, your experience may be different.</p>

<p>If you lose your selection when switching tabs or windows (particularly on Linux), try using <kbd>Ctrl</kbd> + <kbd>U</kbd> to restore it.</p>

<h1>Mouse</h1>

<h2>Windows/Linux</h2>

<p>Building blocks:</p>

<ul><br><li>Positive/negative:<br><br><ul><br><li>Add to selection: <kbd>Ctrl</kbd></li><br><li>Subtract from selection: <kbd>Alt</kbd> <em>In early builds of v3, this didn’t work for linear selection.</em></li><br></ul></li><br><li>Selection type:<br><br><ul><br><li>Linear selection: <kbd>Left Click</kbd></li><br><li>Block selection: <kbd>Middle Click</kbd> or <kbd>Shift</kbd> + <kbd>Right Click</kbd>  <em>On Linux, middle click pastes instead by default.</em></li><br></ul></li><br></ul>

<p>Combine as you see fit.  For example:</p>

<ul><br><li>Add to selection: <kbd>Ctrl</kbd> + <kbd>Left Click</kbd> (and optionally drag)</li><br><li>Subtract from selection: <kbd>Alt</kbd> + <kbd>Left Click</kbd> <em>This didn’t work in early builds of v3.</em></li><br><li>Add block selection: <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>Right Click</kbd> (and drag)</li><br><li>Subtract block selection: <kbd>Alt</kbd> + <kbd>Shift</kbd> + <kbd>Right Click</kbd> (and drag)</li><br></ul>

<h2>Mac OS X</h2>

<p>Building blocks:</p>

<ul><br><li>Positive/negative:<br><br><ul><br><li>Add to selection: <kbd>⌘</kbd></li><br><li>Subtract from selection: <kbd>⇧⌘</kbd> (only works with block selection in v3; presumably bug)</li><br></ul></li><br><li>Selection type:<br><br><ul><br><li>Linear selection: <kbd>Left Click</kbd></li><br><li>Block selection: <kbd>Middle Click</kbd> or <kbd>⌥</kbd> + <kbd>Left Click</kbd></li><br></ul></li><br></ul>

<p>Combine as you see fit.  For example:</p>

<ul><br><li>Add to selection: <kbd>⌘</kbd> + <kbd>Left Click</kbd> (and optionally drag)</li><br><li>Subtract from selection: <kbd>⇧⌘</kbd> + <kbd>Left Click</kbd> (and drag—this combination doesn’t work in Sublime Text 3, but supposedly it works in 2)</li><br><li>Add block selection: <kbd>⌥⌘</kbd> + <kbd>Left Click</kbd> (and drag)</li><br><li>Subtract block selection: <kbd>⌥⇧⌘</kbd> + <kbd>Left Click</kbd> (and drag)</li><br></ul>

<h1>Keyboard</h1>

<h2>Windows</h2>

<ul><br><li>Return to single selection mode: <kbd>Esc</kbd></li><br><li>Extend selection upward/downward at all carets: <kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>Up</kbd>/<kbd>Down</kbd></li><br><li>Extend selection leftward/rightward at all carets: <kbd>Shift</kbd> + <kbd>Left</kbd>/<kbd>Right</kbd></li><br><li>Move all carets up/down/left/right, and clear selection: <kbd>Up</kbd>/<kbd>Down</kbd>/<kbd>Left</kbd>/<kbd>Right</kbd></li><br><li>Undo the last selection motion: <kbd>Ctrl</kbd> + <kbd>U</kbd></li><br><li>Add next occurrence of selected text to selection: <kbd>Ctrl</kbd> + <kbd>D</kbd></li><br><li>Add all occurrences of the selected text to the selection: <kbd>Alt</kbd> + <kbd>F3</kbd></li><br><li>Rotate between occurrences of selected text (single selection): <kbd>Ctrl</kbd> + <kbd>F3</kbd> (reverse: <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>F3</kbd>)</li><br><li>Turn a single linear selection into a block selection, with a caret at the end of the selected text in each line: <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>L</kbd></li><br></ul>

<h2>Linux</h2>

<ul><br><li>Return to single selection mode: <kbd>Esc</kbd></li><br><li>Extend selection upward/downward at all carets: <kbd>Alt</kbd> + <kbd>Up</kbd>/<kbd>Down</kbd>  <em>Note that you may be able to hold <kbd>Ctrl</kbd> as well to get the same shortcuts as Windows, but Linux tends to use Ctrl + Alt combinations for global shortcuts.</em></li><br><li>Extend selection leftward/rightward at all carets: <kbd>Shift</kbd> + <kbd>Left</kbd>/<kbd>Right</kbd></li><br><li>Move all carets up/down/left/right, and clear selection: <kbd>Up</kbd>/<kbd>Down</kbd>/<kbd>Left</kbd>/<kbd>Right</kbd></li><br><li>Undo the last selection motion: <kbd>Ctrl</kbd> + <kbd>U</kbd></li><br><li>Add next occurrence of selected text to selection: <kbd>Ctrl</kbd> + <kbd>D</kbd></li><br><li>Add all occurrences of the selected text to the selection: <kbd>Alt</kbd> + <kbd>F3</kbd></li><br><li>Rotate between occurrences of selected text (single selection): <kbd>Ctrl</kbd> + <kbd>F3</kbd> (reverse: <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>F3</kbd>)</li><br><li>Turn a single linear selection into a block selection, with a caret at the end of the selected text in each line: <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>L</kbd></li><br></ul>

<h2>Mac OS X</h2>

<ul><br><li>Return to single selection mode: <kbd>⎋</kbd> (that’s the Mac symbol for Escape)</li><br><li>Extend selection upward/downward at all carets: <kbd>⌃⇧⇡</kbd>, <kbd>⌃⇧⇣</kbd> (See note)</li><br><li>Extend selection leftward/rightward at all carets: <kbd>⇧⇠</kbd>/<kbd>⇧⇢</kbd></li><br><li>Move all carets up/down/left/right and clear selection: <kbd>⇠</kbd>, <kbd>⇡</kbd>, <kbd>⇣</kbd>, <kbd>⇢</kbd></li><br><li>Undo the last selection motion: <kbd>⌘U</kbd></li><br><li>Add next occurrence of selected text to selection: <kbd>⌘D</kbd></li><br><li>Add all occurrences of the selected text to the selection: <kbd>⌃⌘G</kbd></li><br><li>Rotate between occurrences of selected text (single selection): <kbd>⌥⌘G</kbd> (reverse: <kbd>⌥⇧⌘G</kbd>)</li><br><li>Turn a single linear selection into a block selection, with a caret at the end of the selected text in each line: <kbd>⇧⌘L</kbd></li><br></ul>

<h3>Notes for Mac users</h3>

<p>On Yosemite and El Capitan, <kbd>⌃⇧⇡</kbd> and <kbd>⌃⇧⇣</kbd> are system keyboard shortcuts by default.  If you want them to work in Sublime Text, you will need to change them:</p>

<ol><br><li>Open <code>System Preferences</code>.</li><br><li>Select the <code>Shortcuts</code> tab.</li><br><li>Select <code>Mission Control</code> in the left listbox.</li><br><li>Change the keyboard shortcuts for <code>Mission Control</code> and <code>Application windows</code> (or disable them).  I use <kbd>⌃⌥⇡</kbd> and <kbd>⌃⌥⇣</kbd>.  They defaults are <kbd>⌃⇡</kbd> and <kbd>⌃⇣</kbd>; adding <kbd>⌃</kbd> to those shortcuts triggers the same actions, but slows the animations.</li><br></ol>

<p>In case you’re not familiar with Mac’s keyboard symbols:</p>

<ul><br><li><kbd>⎋</kbd> is the escape key</li><br><li><kbd>⌃</kbd> is the control key</li><br><li><kbd>⌥</kbd> is the option key</li><br><li><kbd>⇧</kbd> is the shift key</li><br><li><kbd>⌘</kbd> is the command key</li><br><li><kbd>⇡</kbd> et al are the arrow keys, as depicted</li><br></ul></span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/06/15/entityframework/" itemprop="url">
                Entity Framework
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-06-15T23:11:59+00:00" content="2016-06-15">
            2016-06-15
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>EDMX (Entity Data Model XML) is an XML file which contains all the mapping details of how your objects map with SQL tables. </p>
<p>The EDMX file is further divided into three sections: CSDL, SSDL, and MSL.</p>
<ul>
<li><p>SSDL (Storage Schema Definition Language) defines the mapping with your RDBMS data structure.</p>
</li>
<li><p>MSL (Mapping Schema Language) connects the CSDL and SSDL.</p>
</li>
<li><p>CSDL (Conceptual Schema definition language) is the conceptual abstraction which is exposed to the application.</p>
</li>
</ul>
<p>What is the importance of T4 in Entity Framework?<br>T4 files are the heart of EF code generation. The T4 code templates read the EDMX XML file and generate C# behind code. This C# behind code is nothing but your entity and context classes.</p>
<p>How can we read records using Entity Framework classes?<br>In order to browse through records you can create the object of the context class and inside the context class you will get the records.</p>
<p>For instance, in the below code snippet we are looping through a customer object collection. This customer collection is the output given by the context class CustomermytextEntities.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">CustomermytestEntities obj = <span class="keyword">new</span> CustomermytestEntities();</span><br><span class="line"><span class="keyword">foreach</span> (Customer objCust <span class="keyword">in</span> obj.Customers)</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>How can we add, update, and delete using EF?<br>Create the object of your entity class, add it to the data context using AddObject method, and then call the SaveChanges method.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">CustomermytestEntities obj = <span class="keyword">new</span> CustomermytestEntities();</span><br><span class="line">Customer objCust = <span class="keyword">new</span> Customer();</span><br><span class="line">objCust.CustomerCode = <span class="string">"1001"</span>;</span><br><span class="line">obj.Customers.AddObject(objCust);</span><br><span class="line">obj.SaveChanges();</span><br></pre></td></tr></table></figure>
<p>If you want to update, select the object, make changes to the object, and call AcceptAllChanges.</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">CustomermytestEntities objContext = <span class="keyword">new</span> CustomermytestEntities();</span><br><span class="line">Customer objCustomer = (Customer)objContext.Customers.FirstOrDefault();</span><br><span class="line">objCustomer.CountryCode = <span class="string">"NEP"</span>;</span><br><span class="line">objContext.AcceptAllChanges();</span><br></pre></td></tr></table></figure>
<p>If you want to delete, call the DeleteObject method as shown in the below code snippet:</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">CustomermytestEntities objContext = <span class="keyword">new</span> CustomermytestEntities();</span><br><span class="line">Customer objCustomer = (Customer)objContext.Customers.FirstOrDefault();</span><br><span class="line">objContext.DeleteObject(objCustomer);</span><br></pre></td></tr></table></figure></span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/03/12/proangularJS/" itemprop="url">
                Pro AngularJS
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-03-12T10:02:59+00:00" content="2016-03-12">
            2016-03-12
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>Models—the M in MVC—contain the data that users work with.<br>There are two broad types of model: view models, which represent just data passed from the controller to the view, and domain models, which contain the data in a business domain, along with the operations, transformations, and rules for creating, storing, and manipulating that data, collectively referred to as the model logic.</p>
<p>For each component in the MVC pattern, I’ll describe what should and should not be included. The model in an<br>application built using the MVC pattern should<br>   Contain the domain data<br>   Contain the logic for creating, managing, and modifying the domain data (even if that means executing remote logic via web services)<br>Provide a clean API that exposes the model data and operations on it The model should not<br>   Expose details of how the model data is obtained or managed (in other words, details of the data storage mechanism or the remote web service should not be exposed to controllers and views)<br>   Contain logic that transforms the model based on user interaction (because this is the controller’s job)<br>   Contain logic for displaying data to the user (this is the view’s job)</p>
<p>   Controllers are the connective tissue in an AngularJS web app, acting as conduits between the data model and views.<br>Controllers add business domain logic (known as behaviors) to scopes, which are subsets of the model.</p>
<p>A controller built using the MVC should<br>   Contain the logic required to initialize the scope<br>   Contain the logic/behaviors required by the view to present data from the scope<br>   Contain the logic/behaviors required to update the scope based on user interaction<br>The controller should not<br>   Contain logic that manipulates the DOM (that is the job of the view)<br>   Contain logic that manages the persistence of data (that is the job of the model)<br>   Manipulate data outside of the scope</p>
<p>The domain model isn’t the only data in an AngularJS application. </p>
<p>Controllers can create view data (also known as view model data or view models) to simplify the definition of views. </p>
<p>View data is not persistent and is created either by synthesizing some aspect of the domain model data or in response to user interaction. </p>
<p>Views should<br>   Contain the logic and markup required to present data to the user Views should not<br>   Contain complex logic (this is better placed in a controller)<br>   Contain logic that creates, stores, or manipulates the domain model<br>Views can contain logic, but it should be simple and used sparingly. Putting anything but the simplest method<br>calls or expressions in a view makes the overall application harder to test and maintain.</p>
<p><strong>Filter - Chapter 14</strong></p>
<p><strong>ng-class - Chapter 11</strong></p>
<p><strong>AngularJS tries to prevent tightly coupled components - Chapter 3.</strong></p>
<p><strong>$filter - Chapter 14</strong></p>
<p><strong>Services - Chapter 3</strong></p>
<p><strong>$http - Chapter 23</strong></p>
<p><strong>jQuery - Chapter 5, Chapter 20</strong></p>
<p><strong>JSON - Chapter 5</strong></p>
<p><strong>built-in directives - Chapter 9-12</strong></p>
<p><strong>Directives use jaLite - Chapter 15</strong></p>
<p><strong>Directives - Chapter 16</strong></p>
<p>When AngularJS encounterrs the <code>ng-include</code> directive,</p>
<p>it makes an Ajax request, loads the file specified by the <code>src</code> attribute,</p>
<p>and inserts the contents in place of the element.</p>
<p><strong>Services - Chapter 18</strong></p>
<p>Directives are created by calling the <code>directive</code> method on an AngularJS module and passing in the name of the directive (cartSumary in this case)</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">angular.module(&#34;cart&#34;, [])&#10;.directive(&#34;cartSummary&#34;, function (cart) &#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>and a factory function that returns a <strong>directive definition object</strong>.</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">return &#123;&#10;     restrict: &#34;E&#34;,&#10;     templateUrl: &#34;components/cart/cartSummary.html&#34;,&#10;     controller: function ($scope) &#123;&#10;         var cartData = cart.getProducts();&#10;         $scope.total = function () &#123;&#10;             var total = 0;&#10;             for (var i = 0; i &#60; cartData.length; i++) &#123;&#10;                 total += (cartData[i].price * cartData[i].count);&#10;             &#125;&#10;             return total;&#10;         &#125;&#10;         $scope.itemCount = function () &#123;&#10;             var total = 0;&#10;             for (var i = 0; i &#60; cartData.length; i++) &#123;&#10;                 total += cartData[i].count;&#10;            &#125;&#10;             return total;&#10;         &#125;&#10;      &#125;&#10;   &#125;;</span><br></pre></td></tr></table></figure>
<p><strong>Complete set of Directive properties in Chapters 16 and 17. </strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>restrict</td>
<td>Sepcifies how the directive can be applied. I have used a value of <code>E</code>, which means that this directive can be applied only as an element. The most common value is <code>EA</code>, which means that the directive can be applied as an element or as an attribute.</td>
</tr>
<tr>
<td>templateUrl</td>
<td>Specifies the URL of a partial view whose contents will be inserted in to the directive’s element.</td>
</tr>
<tr>
<td>controller</td>
<td>Specifies a controller that will provide data and behaviors to the partial view.</td>
</tr>
</tbody>
</table>
<p><strong>AngularJS normalizes component names - Chapter 15. </strong> </p>
<p><strong>URL routing - Chapter 22. </strong></p>
<p>URl routing - it allows for different partial views to be displayed automatically based on the current URL.</p>
<p><strong>ngRoute - angularjs-route.js </strong></p>
<p>Call <code>config</code> method on the module object. </p>
<p>The <code>config</code> method takes a function as its argument, which is executed <strong>when the module is loaded but before the application is executed</strong>, providing an opportunity for any one-off configuration tasks.</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">angular.module(&#34;sportsStore&#34;, [&#34;customFilters&#34;, &#34;cart&#34;, &#34;ngRoute&#34;]) &#10;.config(function ($routeProvider) &#123;&#125; )</span><br></pre></td></tr></table></figure>
<p>The function that I passed to the <code>config</code> method declares a dependency on a provider.</p>
<p>One of creating a service is that can be configured through a <em>provider object</em>, whose name is the concatenation of the service name and <code>Provider</code>.One</p>
<p>The <code>$routeProvider</code> that I have declared a dependency on is the provider for the <code>$route</code> service and is used to set up the URL routing in an application.</p>
<p><strong> Create services with providers — Chapter 18 </strong></p>
<p><strong> <code>$route</code> and <code>$routeProvider</code> — Chapter 22 </strong></p>
<p>*<code>when</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">$routeProvider.when(&#34;/checkout&#34;, &#123; ... &#125;);</span><br></pre></td></tr></table></figure>
<p>*<code>otherwise</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">$routeProvider.otherwise(&#123; ... &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="novalidate"><code>novalidate</code></h4><p>disable any validation that the browser might try to perform.</p>
<p><strong>URL routing feature to prevent AngularJS from displaying the view until the Ajax request has been completed. - Chapter 22</strong></p>
<p><strong>Use promises to build chains of behavior - Chapter 20 </strong></p>
<p><strong>$animate - Chapter 23</strong></p>
<p><strong>complete set of configuration options use URL routes - Chapter 22</strong></p>
<p><strong>$http.post - Chapter 20</strong></p>
<p><em>*$location - Chapter 11</em></p>
<p><strong>$http - Chapter 20</strong></p>
<p><strong>how services work - Chapter 18</strong></p>
<p><strong>Scopes - Chapter 13</strong></p>
<h3 id="Understanding_Dependency_Injection">Understanding Dependency Injection</h3><h2 id="Using_the_Form_Directive_Attributes">Using the Form Directive Attributes</h2><h3 id="Input">Input</h3><p>** Only works when the input element does not have a <code>type</code> attribute or when the <code>type</code> attribute is<br><code>text</code>, <code>url</code>, <code>email</code>, or <code>number</code>.</p>
<table>
<thead>
<tr>
<th>name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ng-model</td>
<td>Specifies a two-model binding, as descibed earlier in this chapter</td>
</tr>
<tr>
<td>ng-change</td>
<td>Specifies an expression that is evaluated when the contents of the element are changed</td>
</tr>
<tr>
<td>ng-minlength</td>
<td>Sets a minimum number of characters required for the element to be valid</td>
</tr>
<tr>
<td>ng-maxlength</td>
<td>Sets a maximum number of characters required for the element to be valid</td>
</tr>
<tr>
<td>ng-pattern</td>
<td>Sets a regular expression. The contents of the element must match this pattern in order to be valid</td>
</tr>
<tr>
<td>ng-required</td>
<td>Sets the value of the required attribute with a data binding</td>
</tr>
</tbody>
</table>
<h3 id="Checkbox">Checkbox</h3><p>The Attributes That Can Be Used for an input Element Whose type Attribute Is checkbox</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ng-model</td>
<td>Specifies a two-model binding, as described earlier in this chapter</td>
</tr>
<tr>
<td>ng-change</td>
<td>Specifies an expression that is evaluated when the contents of the element are changed</td>
</tr>
<tr>
<td>ng-true-value</td>
<td>Specifies the value that the model binding expression will be set to when the element is checked</td>
</tr>
<tr>
<td>ng-false-value</td>
<td>Specifies the value</td>
</tr>
</tbody>
</table>
<h3 id="Text_Areas">Text Areas</h3><table>
<thead>
<tr>
<th>name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ng-model</td>
<td>Specifies a two-model binding, as descibed earlier in this chapter</td>
</tr>
<tr>
<td>ng-change</td>
<td>Specifies an expression that is evaluated when the contents of the element are changed</td>
</tr>
<tr>
<td>ng-minlength</td>
<td>Sets a minimum number of characters required for the element to be valid</td>
</tr>
<tr>
<td>ng-maxlength</td>
<td>Sets a maximum number of characters required for the element to be valid</td>
</tr>
<tr>
<td>ng-pattern</td>
<td>Sets a regular expression. The contents of the element must match this pattern in order to be valid</td>
</tr>
<tr>
<td>ng-required</td>
<td>Sets the value of the required attribute with a data binding</td>
</tr>
</tbody>
</table>
<h3 id="Select">Select</h3><table>
<thead>
<tr>
<th>name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ng-options</td>
<td></td>
</tr>
<tr>
<td>ng-required</td>
</tr>
</tbody>
</table>
<p><code>ng-options=&quot;item.action for item in todos&quot;</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">select</span> <span class="attribute">ng-model</span>=<span class="value">"selectValue"</span> <span class="attribute">ng-options</span>=<span class="value">"item.action for item in todos"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">option</span> <span class="attribute">value</span>=<span class="value">""</span>&gt;</span>(Pick One)<span class="tag">&lt;/<span class="title">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">select</span> <span class="attribute">ng-model</span>=<span class="value">"selectValue"</span> <span class="attribute">ng-options</span>=<span class="value">"item.id as item.action for item in todos"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">option</span> <span class="attribute">value</span>=<span class="value">""</span>&gt;</span>(Pick One)<span class="tag">&lt;/<span class="title">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">ng-options="item.action group by item.place for item in todos"&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">ng-options="item.id as item.action group by item.place for item in todos"&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Using_the_Services_Method">Using the Services Method</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">var baseLogger = function () &#123;&#10;&#10;    this.messageCount = 0;&#10;&#10;    this.log = function (msg) &#123;&#10;        console.log(this.msgType + &#34;: &#34; + (this.messageCount++) + &#34; &#34; + msg);&#10;    &#125;&#10;&#125;;&#10;&#10;var debugLogger = function () &#123; &#125;;&#10;&#10;debugLogger.prototype = new baseLogger();&#10;&#10;debugLogger.prototype.msgType = &#34;Debug&#34;;&#10;&#10;var errorLogger = function () &#123; &#125;;&#10;&#10;errorLogger.prototype = new baseLogger();&#10;&#10;errorLogger.prototype.msgType = &#34;Error&#34;;&#10;&#10;angular.module(&#34;customServices&#34;, [])&#10;.service(&#34;logService&#34;, debugLogger)&#10;.service(&#34;errorService&#34;, errorLogger);</span><br></pre></td></tr></table></figure>
<h3 id="Using_Factory_Method">Using Factory Method</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">angular.module(&#34;customServices&#34;, [])&#10;    .factory(&#34;logService&#34;, function () &#123;&#10;        var messageCount = 0;&#10;        return &#123;&#10;            log: function (msg) &#123;&#10;            console.log(&#34;(LOG + &#34; + messageCount++ + &#34;) &#34; + msg);&#10;        &#125;&#10;    &#125;;&#10;&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">angular.module(&#34;customServices&#34;, [])&#10;    .provider(&#34;logService&#34;, function()&#123;&#10;            return &#123;&#10;                $get: function() &#123;&#10;                    return &#123;&#10;                        messageCount: 0,&#10;                        log: function(msg) &#123;&#10;                            console.log(&#34;(LOG + &#34; + this.messageCount++ + &#34;) &#34; + msg);&#10;                        &#125;&#10;                    &#125;;&#10;                &#125;&#10;            &#125;;&#10;        &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Table_9-3-_The_Members_of_the_Module_Object">Table 9-3. The Members of the Module Object</h3><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>animation(name, factory)</td>
<td>Supports the animation feature, which I describe in Chapter 23.</td>
</tr>
<tr>
<td>config(callback)</td>
<td>Registers a function that can be used to configure a module when it is loaded. See the “Working with the Module Life Cycle” section for details.</td>
</tr>
<tr>
<td>constant(key, value)</td>
<td>Defines a service that returns a constant value. See the “Working with the Module Life Cycle” section later in this chapter.</td>
</tr>
<tr>
<td>controller(name, constructor)</td>
<td>Creates a controller. See Chapter 13 for details.</td>
</tr>
<tr>
<td>directive(name, factory)</td>
<td>Creates a directive, which extends the standard HTML vocabulary. See Chapters 15–17.</td>
</tr>
<tr>
<td>factory(name, provider)</td>
<td>Creates a service. See Chapter 18 for details and an explanation of how this method differs from the provider and service methods.</td>
</tr>
<tr>
<td>filter(name, factory)</td>
<td>Creates a filter that formats data for display to the user. See Chapter 14 for details.</td>
</tr>
<tr>
<td>provider(name, type)</td>
<td>Creates a service. See Chapter 18 for details and an explaination of how this method differs from the service and factory methods. </td>
</tr>
<tr>
<td>name</td>
<td>Returns the name of the module.</td>
</tr>
<tr>
<td>run(callback)</td>
<td>Registers a function that is invoked after AngularJS has loaded and configured all of the modules. See the “Working with the Module Life Cycle” section for details.</td>
</tr>
<tr>
<td>service(name, constructor)</td>
<td>Creates a service. See Chapter 18 for details and an explanation of how this method differs from the provider and factory methods.</td>
</tr>
<tr>
<td>value(name, value)</td>
<td>Defines a service that returns a constant value; see the “Defining Values” section later in this chapter.</td>
</tr>
</tbody>
</table>
<p>List:</p>
<table>
<thead>
<tr>
<th>Problem</th>
<th>Solution</th>
<th>Listing</th>
</tr>
</thead>
<tbody>
<tr>
<td>Define a service.</td>
<td>Use the Module.service, Module.factory, or Module.provider method.</td>
<td>12</td>
</tr>
<tr>
<td>Define a service from an existing object or value.</td>
<td>Use the Module.value method.</td>
<td>13</td>
</tr>
<tr>
<td>Add structure to the code in an application.</td>
<td>Create multiple modules and declare dependencies from the module referenced by the ng-app attribute.</td>
<td>14–16</td>
</tr>
<tr>
<td>Register functions that are called when modules are loaded.</td>
<td>Use the Module.config and Module.run methods.</td>
<td>17</td>
</tr>
</tbody>
</table>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">angular.module(&#34;customServices&#34;, [])&#10;    .provider(&#34;logService&#34;, function()&#123;&#10;            return &#123;&#10;                $get: function() &#123;&#10;                    return &#123;&#10;                        messageCount: 0,&#10;                        log: function(msg) &#123;&#10;                            console.log(&#34;(LOG + &#34; + this.messageCount++ + &#34;) &#34; + msg);&#10;                        &#125;&#10;                    &#125;;&#10;                &#125;&#10;            &#125;;&#10;        &#125;);</span><br></pre></td></tr></table></figure>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/02/21/essentialcsharpchapter13/" itemprop="url">
                Essential C# 5.0 Note - Chapter 13 - Events
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-02-21T07:51:50+00:00" content="2016-02-21">
            2016-02-21
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"></span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/02/15/factory/" itemprop="url">
                Factory, Abstract Factory and Factory Method
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-02-15T10:58:52+00:00" content="2016-02-15">
            2016-02-15
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h2 id="Simple_Sample-cs">Simple Sample.cs</h2><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GossipDesignPattern.SimpleFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            Console.Write(<span class="string">"input first number:"</span>);</span><br><span class="line">            <span class="keyword">string</span> A = Console.ReadLine();</span><br><span class="line"></span><br><span class="line">            Console.Write(<span class="string">"(+,-,*,/): "</span>);</span><br><span class="line">            <span class="keyword">string</span> B = Console.ReadLine();</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(<span class="string">"input second number:"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">string</span> C = Console.ReadLine();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">string</span> D = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (B == <span class="string">"+"</span>)</span><br><span class="line">                D = Convert.ToString(Convert.ToDouble(A) + Convert.ToDouble(C));</span><br><span class="line">            <span class="keyword">if</span> (B == <span class="string">"-"</span>)</span><br><span class="line">                D = Convert.ToString(Convert.ToDouble(A) - Convert.ToDouble(C));</span><br><span class="line">            <span class="keyword">if</span> (B == <span class="string">"*"</span>)</span><br><span class="line">                D = Convert.ToString(Convert.ToDouble(A) * Convert.ToDouble(C));</span><br><span class="line">            <span class="keyword">if</span> (B == <span class="string">"/"</span>)</span><br><span class="line">                D = Convert.ToString(Convert.ToDouble(A) / Convert.ToDouble(C));</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(<span class="string">"result: "</span> + D);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ProgramV2</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                Console.Write(<span class="string">"input first number:"</span>);</span><br><span class="line">                <span class="keyword">string</span> strNumberA = Console.ReadLine();</span><br><span class="line"></span><br><span class="line">                Console.Write(<span class="string">"(+,-,*,/): "</span>);</span><br><span class="line">                <span class="keyword">string</span> strOperate = Console.ReadLine();</span><br><span class="line"></span><br><span class="line">                Console.WriteLine(<span class="string">"input second number:"</span>);</span><br><span class="line">                <span class="keyword">string</span> strNumberB = Console.ReadLine();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">string</span> strResult = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">switch</span> (strOperate)</span><br><span class="line">                &#123; </span><br><span class="line">                    <span class="keyword">case</span> <span class="string">"+"</span>:</span><br><span class="line">                        strResult = Convert.ToString(Convert.ToDouble(strNumberA) + Convert.ToDouble(strNumberB));</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">"-"</span>:</span><br><span class="line">                        strResult = Convert.ToString(Convert.ToDouble(strNumberA) - Convert.ToDouble(strNumberB));</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">"*"</span>:</span><br><span class="line">                        strResult = Convert.ToString(Convert.ToDouble(strNumberA) * Convert.ToDouble(strNumberB));</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">"/"</span>:</span><br><span class="line">                        <span class="keyword">if</span> (strNumberB != <span class="string">"0"</span>)</span><br><span class="line">                            strResult = Convert.ToString(Convert.ToDouble(strNumberA) / Convert.ToDouble(strNumberB));</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                            strResult = <span class="string">"Divisor can't be 0"</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                Console.WriteLine(<span class="string">"result: "</span> + strResult);</span><br><span class="line"></span><br><span class="line">                Console.ReadLine();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">"Error input:"</span> + ex.ToString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Operation</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">GetResult</span>(<span class="params"><span class="keyword">double</span> numberA, <span class="keyword">double</span> numberB, <span class="keyword">string</span> operate</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">double</span> result = <span class="number">0</span>d;</span><br><span class="line">            <span class="keyword">switch</span> (operate)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"+"</span>:</span><br><span class="line">                    result = numberA + numberB;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"-"</span>:</span><br><span class="line">                    result = numberA - numberB;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"*"</span>:</span><br><span class="line">                    result = numberA * numberB;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"/"</span>:</span><br><span class="line">                    result = numberA / numberB;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                Console.Write(<span class="string">"input first number:"</span>);</span><br><span class="line">                <span class="keyword">string</span> strNumberA = Console.ReadLine();</span><br><span class="line"></span><br><span class="line">                Console.Write(<span class="string">"(+,-,*,/): "</span>);</span><br><span class="line">                <span class="keyword">string</span> strOperate = Console.ReadLine();</span><br><span class="line"></span><br><span class="line">                Console.WriteLine(<span class="string">"input second number:"</span>);</span><br><span class="line">                <span class="keyword">string</span> strNumberB = Console.ReadLine();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">string</span> strResult = <span class="string">""</span>;</span><br><span class="line">                </span><br><span class="line">                strResult = Convert.ToString(Operation.GetResult(Convert.ToDouble(strNumberA), Convert.ToDouble(strNumberB), strOperate));</span><br><span class="line"></span><br><span class="line">                Console.WriteLine(<span class="string">"result: "</span> + strResult);</span><br><span class="line"></span><br><span class="line">                Console.ReadLine();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">"Error input:"</span> + ex.ToString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OperationBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">double</span> _numberA = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">double</span> _numberB = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">double</span> NumberA &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> _numberA; &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; _numberA = <span class="keyword">value</span>; &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">double</span> NumberB</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> _numberB; &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; _numberB = <span class="keyword">value</span>; &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">double</span> <span class="title">GetResult</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">double</span> result = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">OperationAdd</span> : <span class="title">OperationBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">double</span> <span class="title">GetResult</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">double</span> result = <span class="number">0</span>;</span><br><span class="line">            result = NumberA + NumberB;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">OperationSub</span> : <span class="title">OperationBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">double</span> <span class="title">GetResult</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">double</span> result = <span class="number">0</span>;</span><br><span class="line">            result = NumberA - NumberB;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">OperationMul</span> : <span class="title">OperationBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">double</span> <span class="title">GetResult</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">double</span> result = <span class="number">0</span>;</span><br><span class="line">            result = NumberA * NumberB;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">OperationDiv</span> : <span class="title">OperationBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">double</span> <span class="title">GetResult</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            <span class="keyword">double</span> result = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (NumberB == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"Divisor can't be 0"</span>);</span><br><span class="line">            </span><br><span class="line">            result = NumberA / NumberB;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OperationFactory</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> OperationBase <span class="title">CreateOperate</span>(<span class="params"><span class="keyword">string</span> operate</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            OperationBase oper = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">switch</span> (operate)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"+"</span>:</span><br><span class="line">                    oper = <span class="keyword">new</span> OperationAdd();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"-"</span>:</span><br><span class="line">                    oper = <span class="keyword">new</span> OperationSub();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"*"</span>:</span><br><span class="line">                    oper = <span class="keyword">new</span> OperationMul();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"/"</span>:</span><br><span class="line">                    oper = <span class="keyword">new</span> OperationDiv();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> oper;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            OperationBase oper;</span><br><span class="line">            oper = OperationFactory.CreateOperate(<span class="string">"+"</span>);</span><br><span class="line">            oper.NumberA = <span class="number">1</span>;</span><br><span class="line">            oper.NumberB = <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">double</span> result = oper.GetResult();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FactoryMethod</span></span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">interface</span> <span class="title">IFactory</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function">OperationBase <span class="title">CreateOperation</span>(<span class="params"></span>)</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">class</span> <span class="title">AddFactory</span> : <span class="title">IFactory</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> OperationBase <span class="title">CreateOperation</span>(<span class="params"></span>)</span><br><span class="line">            </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> OperationAdd();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">class</span> <span class="title">SubFactory</span> : <span class="title">IFactory</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> OperationBase <span class="title">CreateOperation</span>(<span class="params"></span>)</span><br><span class="line">            </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> OperationSub();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">class</span> <span class="title">MulFactory</span> : <span class="title">IFactory</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> OperationBase <span class="title">CreateOperation</span>(<span class="params"></span>)</span><br><span class="line">            </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> OperationMul();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">class</span> <span class="title">DivFactory</span> : <span class="title">IFactory</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> OperationBase <span class="title">CreateOperation</span>(<span class="params"></span>)</span><br><span class="line">            </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> OperationDiv();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            IFactory operFactory = <span class="keyword">new</span> AddFactory();</span><br><span class="line">            OperationBase oper = operFactory.CreateOperation();</span><br><span class="line">            oper.NumberA = <span class="number">1</span>;</span><br><span class="line">            oper.NumberB = <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">double</span> result = oper.GetResult();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="LeiFeng-cs">LeiFeng.cs</h2><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GossipDesignPattern.SimpleFactory</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 简单工厂模式的最大优点在于工厂类中包含了必要的逻辑判断, 根据客户端的选择条件动态实例化相关的类，对于客户端来说，去除了与具体产品的依赖。</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">LeiFeng</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Sweep</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            Console.WriteLine(<span class="string">"Sweep!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Wash</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            Console.WriteLine(<span class="string">"Wash!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">BuyRice</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            Console.WriteLine(<span class="string">"Buy Rice!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Undergraduate</span>: <span class="title">LeiFeng</span></span><br><span class="line">    &#123; </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">IamUndergraduate</span>(<span class="params"></span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            Console.WriteLine(<span class="string">"I am undergraduate!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ProgramV3</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params"><span class="keyword">string</span> [] args</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            LeiFeng xueleifeng = <span class="keyword">new</span> Undergraduate();</span><br><span class="line"></span><br><span class="line">            xueleifeng.BuyRice();</span><br><span class="line">            xueleifeng.Sweep();</span><br><span class="line">            xueleifeng.Wash();</span><br><span class="line"></span><br><span class="line">            LeiFeng student1 = <span class="keyword">new</span> Undergraduate();</span><br><span class="line">            student1.BuyRice();</span><br><span class="line"></span><br><span class="line">            LeiFeng student2 = <span class="keyword">new</span> Undergraduate();</span><br><span class="line">            student1.Sweep();</span><br><span class="line"></span><br><span class="line">            LeiFeng student3 = <span class="keyword">new</span> Undergraduate();</span><br><span class="line">            student1.Wash();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Volunteer</span> : <span class="title">LeiFeng</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">SimpleFactory</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LeiFeng <span class="title">CreateLeiFeng</span>(<span class="params"><span class="keyword">string</span> type</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            LeiFeng result = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">switch</span> (type)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"Undergraduate"</span>:</span><br><span class="line">                    result = <span class="keyword">new</span> Undergraduate();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"Volunteer"</span>:</span><br><span class="line">                    result = <span class="keyword">new</span> Volunteer();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            LeiFeng studentA = SimpleFactory.CreateLeiFeng(<span class="string">"Undergraduate"</span>);</span><br><span class="line"></span><br><span class="line">            studentA.BuyRice();</span><br><span class="line"></span><br><span class="line">            LeiFeng studentB = SimpleFactory.CreateLeiFeng(<span class="string">"Undergraduate"</span>);</span><br><span class="line"></span><br><span class="line">            studentB.Sweep();</span><br><span class="line"></span><br><span class="line">            LeiFeng studentC = SimpleFactory.CreateLeiFeng(<span class="string">"Undergraduate"</span>);</span><br><span class="line"></span><br><span class="line">            studentC.Wash();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//工厂方法克服了简单工厂违背开放-封闭原则的缺点，又保持了封装对象创建过程的优点</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">FactoryMethodForLeiFeng</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">interface</span> <span class="title">ILeiFengFactory</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function">LeiFeng <span class="title">CreateLeiFeng</span>(<span class="params"></span>)</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">class</span> <span class="title">UndergraduateFactory</span> : <span class="title">ILeiFengFactory</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> LeiFeng <span class="title">CreateLeiFeng</span>(<span class="params"></span>)</span><br><span class="line">            </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Undergraduate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">class</span> <span class="title">VolunteerFactory</span> : <span class="title">ILeiFengFactory</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> LeiFeng <span class="title">CreateLeiFeng</span>(<span class="params"></span>)</span><br><span class="line">            </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Volunteer();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span><br><span class="line">        </span>&#123;</span><br><span class="line">            ILeiFengFactory factory = <span class="keyword">new</span> UndergraduateFactory();</span><br><span class="line"></span><br><span class="line">            LeiFeng student = factory.CreateLeiFeng();</span><br><span class="line"></span><br><span class="line">            student.BuyRice();</span><br><span class="line">            student.Sweep();</span><br><span class="line">            student.Wash();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2016/02/14/howgarbagecollectionworks/" itemprop="url">
                How Garbage Collection works in .Net
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Posted on
          <time itemprop="dateCreated" datetime="2016-02-14T23:19:11+00:00" content="2016-02-14">
            2016-02-14
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h2 id="Understanding_the_Basics_of_Working_in_a_Garbage-Collected_Platform">Understanding the Basics of Working in a Garbage-Collected Platform</h2><p>Every program uses resources of one sort or another, be they files, memory buffers, screen<br>space, network connections, database resources, and so on. </p>
<p>In fact, in an object-oriented environment, every <strong>type</strong> identifies some resource available for a program’s use. </p>
<p>To use any of these resources requires memory to be allocated to represent the type. The following steps are required to access a resource:</p>
<ol>
<li><p>Allocate memory for the type that represents the resource by calling the intermediate<br>language’s <strong>newobj</strong> instruction, which is emitted when you use <strong>the new operator in C#</strong>.</p>
</li>
<li><p><strong>Initialize the memory</strong> to <strong>set the initial state</strong> of the resource and to <strong>make the resource usable</strong>. The type’s <strong>instance constructor</strong> is responsible for setting this initial state.</p>
</li>
<li><p><strong>Use the resource</strong> by <strong>accessing the type’s members</strong> (repeating as necessary).</p>
</li>
<li><p><strong>Tear down</strong>(vt. 向 猛扑，冲下; 拆毁，拆卸) the state of a resource to clean up.<br>I’ll address this topic in the section “The Dispose Pattern: Forcing an Object to Clean Up” later in this chapter.</p>
</li>
<li><p>Free the memory. The <strong>garbage collector</strong> is solely <strong>responsible</strong> for this step.</p>
</li>
</ol>
<p>This seemingly simple paradigm has been one of the major sources of programming errors.</p>
<p><em>How many times have programmers forgotten to free memory when it is no longer needed? 
</em>How many times have programmers attempted to use memory after it had already been freed?</p>
<p>With unmanaged programming, these two application bugs are worse than most others<br>because you usually can’t predict the consequences or the timing of them. </p>
<p>For other bugs, when you see your application misbehaving, you just fix the problem. </p>
<p>But these two bugs cause resource leaks (memory consumption) and object corruption (destabilization), making the application perform unpredictably. </p>
<p>In fact, there are many tools (such as the Microsoft Windows Task Manager, the System Monitor ActiveX Control, NuMega BoundsChecker from Compuware, and Rational’s Purify) that are specifically designed to help developers locate these types of bugs.</p>
<p>Proper resource management is very difficult and quite tedious(adj. 单调沉闷的; 冗长乏味的; 令人生厌的). </p>
<p>It distracts developers from concentrating on the real problems that they’re trying to solve. </p>
<p>It would be wonderful if some mechanism existed that simplified the mind-numbing(adj.<br>（糟糕、无聊或程度强烈到）令人头脑麻木的) memory-management task for developers.</p>
<p>Fortunately, there is: <strong>Garbage Collection</strong>.</p>
<p>Garbage collection completely absolves the developer from having to track memory usage and<br>know when to free memory. </p>
<p>However, the garbage collector doesn’t know anything about the resource represented by the type in memory, which means that a garbage collector can’t know how to perform Step 4 in the preceding list: </p>
<blockquote>
<p>tear down the state of a resource to clean up. </p>
</blockquote>
<p>To get a resource to clean up properly, the developer must write code that knows how to properly clean up a resource. </p>
<p>The developer writes this code in the <code>Finalize</code>, <code>Dispose</code>, and <code>Close</code> methods, as described later in this chapter. </p>
<p>However, as you’ll see, the garbage collector can offer some assistance here too, allowing developers to skip Step 4 in many circumstances.</p>
<p>Also, most types, including String, Attribute, Delegate, and Exception, represent resources<br>that don’t require any special cleanup. </p>
<p>For example, a String resource can be completely cleaned up simply by destroying the character array maintained in the object’s memory.</p>
<p>On the other hand, a type that represents (or wraps) an unmanaged or native resource, such<br>as a file, a database connection, a socket, a mutex, a bitmap, an icon, and so on, always<br>requires the execution of some cleanup code when the object is about to have its memory<br>reclaimed. </p>
<p>In this chapter, I’ll explain how to properly define types that require explicit clean<br>up, and I’ll show you how to properly use types that offer this explicit clean-up. </p>
<p>For now, let’s examine how memory is allocated and how resources are initialized.</p>
<h2 id="Allocating_Resources_from_the_Managed_Heap">Allocating Resources from the Managed Heap</h2><p>The CLR requires that all resources to be allocated from a heap called <strong>the managed heap</strong>. </p>
<p>This heap is similar to a C-runtime heap, except that you <strong>never delete objects</strong> from the managed heap.</p>
<p>Objects are <strong>automatically deleted</strong> when the application no longer needs them. </p>
<p>This, of course, raises the que stion, “How does the managed heap know when the application is no longer using an object?” I’ll address this question shortly.</p>
<p>Several garbage-collection algorithms are in use today. </p>
<p>Each algorithm is fine-tuned for a particular environment to provide the best performance. </p>
<p>In this chapter, I’ll concentrate on the garbage-collection algorithm used by the Microsoft .NET Framework’s CLR. </p>
<p>Let’s start off with the basic concepts.</p>
<p>When a process is initialized, the CLR reserves a contiguous region of address space that initially contains no backing storage. </p>
<p>This address space region is the managed heap. </p>
<p>The heap also maintains a pointer, which I’ll call NextObjPtr. This pointer indicates where the next object is to be allocated within the heap. </p>
<p>Initially, NextObjPtr is set to the base address of the reserved address space region.</p>
<p>The <strong>newobj</strong> intermediate language (IL) instruction creates an object. </p>
<p>Many languages (including C#, C++/CLI, and Microsoft Visual Basic) offer a new operator that causes the compiler to <strong>emit a newobj instruction</strong> into the method’s IL code. </p>
<p>The newobj instruction causes the CLR to perform the following steps:</p>
<ol>
<li><p>Calculate the number of bytes required for the type’s (and all of its base type’s) fields.</p>
</li>
<li><p>Add the bytes required for an object’s overhead. Each object has two overhead fields:<br>a type object pointer and a sync block index. For a 32-bit application, each of these<br>fields requires 32 bits, adding 8 bytes to each object. For a 64-bit application, each field<br>is 64 bits, adding 16 bytes to each object.</p>
</li>
<li><p>The CLR then checks that the bytes required to allocate the object are available in the<br>reserved region (committing storage if necessary). If there is enough free space in the<br>managed heap, the object will fit, starting at the address pointed to by NextObjPtr,<br>and these bytes are zeroed out. The type’s constructor is called (passing NextObjPtr<br>for the this parameter), and the newobj IL instruction (or C#’s new operator) returns<br>the address of the object. Just before the address is returned, NextObjPtr is advanced<br>past the object and now points to the address where the next object will be placed in<br>the heap.</p>
</li>
</ol>
<p>Figure 20-1 shows a managed heap consisting of three objects: A, B, and C. If a new object<br>were to be allocated, it would be placed where <strong>NextObjPtr</strong> points to (immediately after<br>object C).</p>
<p>By contrast, let’s look at how the C-runtime heap allocates memory. </p>
<p>In a C-runtime heap, allocating memory for an object requires walking through a linked list of data structures. </p>
<p>Once a large enough block is found, that block is split, and pointers in the linked-list nodes<br>are modified to keep everything intact. </p>
<p>For the managed heap, allocating an object simply means adding a value to a pointer—this is blazingly fast by comparison. </p>
<p>In fact, allocating an object from the managed heap is nearly as fast as allocating memory from a thread’s stack! </p>
<p>In addition, most heaps (such as the C-runtime heap) allocate objects wherever they find free space.</p>
<p>Therefore, if I create several objects consecutively, it’s quite possible for these objects to be separated by megabytes of address space.</p>
<p>In the managed heap, however, allocating several objects consecutively ensures that the objects are contiguous in memory.</p>
<p>In many applications, objects allocated around the same time tend to have strong relationships to each other and are frequently accessed around the same time. </p>
<p>For example, it’s very common to allocate a FileStream object immediately before a BinaryWriter object is created. Then the application would use the BinaryWriter object, which internally uses the<br>FileStream object. </p>
<p>In a garbage-collected environment, new objects are allocated contiguously in memory, providing performance gains resulting from locality of reference. </p>
<p>Specifically, this means that your process’ working set will be smaller than a similar application running in a non-managed environment. </p>
<p>It’s also likely that the objects that your code is using can all reside in the CPU’s cache. </p>
<p>Your application will access these objects with phenomenal speed because the CPU will be able to perform most of its manipulations without having cache misses that would force slower access to RAM.</p>
<p>So far, it sounds as if the managed heap is far superior to the C-runtime heap because of its simplicity of implementation and speed. </p>
<p>But there’s one little detail you should know about before getting too excited. </p>
<p>The managed heap gains these advantages because it makes one really big assumption: that address space and storage are infinite. </p>
<p>Obviously, this assumption is ridiculous, and the managed heap must employ a mechanism to allow it to make this assumption. </p>
<p>This mechanism is the garbage collector. </p>
<p>Here’s how it works:</p>
<p>When an application calls the new operator to create an object, there might not be enough address space left in the region to allocate to the object. </p>
<p>The heap detects this lack of space by adding the bytes that the object requires to the address in NextObjPtr. </p>
<p>If the resulting value is beyond the end of the address space region, the heap is full, and a garbage collection must be performed.</p>
<p>Important:<br>What I’ve just said is an oversimplification. </p>
<p>In reality, a garbage collection occurs when generation 0 is full. </p>
<p>Some garbage collectors use generations, a mechanism whose sole purpose is to improve performance. </p>
<p>The idea is that newly created objects are part of a young generation and objects created early in the application’s lifecycle are in an old generation.</p>
<p>Objects in Generation 0 are objects that have recently been allocated and have never been examined by the garbage collector algorithm.</p>
<p>Objects that survive a collection are promoted to another generation (such as Generation 1). </p>
<p>Separating objects into generations allows the garbage collector to collect specific generations instead of collecting all of the objects in the managed heap. </p>
<p>I’ll explain generations in more detail later in this chapter. </p>
<p>Until then, it’s easiest for you to think that a garbage collection occurs when the heap is full. </p>
<h2 id="The_Garbage_Collection_Algorithm">The Garbage Collection Algorithm</h2><p>The garbage collector checks to see if any objects in the heap are no longer being used by the application. </p>
<p>If such objects exist, the memory used by these objects can be reclaimed. </p>
<p>(If no more memory is available in the heap after a garbage collection,new throws an OutOfMemory-Exception.)</p>
<p>How does the garbage collector know whether the application is using an object?</p>
<p>As you might imagine, this isn’t a simple question to answer.</p>
<p>Every application has a set of roots. </p>
<p>A single root is a storage location containing a memory pointer to a reference type object. </p>
<p>This pointer either refers to an object in the managed heap or is set to null. </p>
<p>For example, a static field (defined within a type) is considered a root. </p>
<p>In addition, any method parameter or local variable is also considered a root. </p>
<p>Only variables that are of a reference type are considered roots; value type variables are never considered roots.</p>
<p>Now, let’s look at a concrete example starting with the following class definition:</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">SomeType</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> TextWriter m_textWriter;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SomeType</span>(<span class="params">TextWriter tw</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        m_textWriter = tw;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">WriteBytes</span>(<span class="params">Byte[] bytes</span>)</span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Int32 x = <span class="number">0</span>; x &lt; bytes.Length; x++)</span><br><span class="line">        &#123;</span><br><span class="line">            m_textWriter.Write(bytes[x]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The first time the WriteBytes method is called, the JIT compiler converts the method’s IL code into native CPU instructions. Let’s say the CLR is running on an x86 CPU, and the JIT<br>compiler compiles the WriteBytes method into the CPU instructions shown in Figure 20-2.</p>
<p>(I added comments on the right to help you understand how the native code maps back to the original source code.)</p>
<p>00000000 push edi                       // Prolog<br>00000001 push esi<br>00000002 push ebx<br>00000003 mov ebx,ecx                    // ebx = this (argument)<br>00000005 mov esi,edx                    // esi = bytes array (argument)<br>00000007 xor edi,edi                    // edi = x (a value type)<br>00000009 cmp dword ptr [esi+4],0        // compare bytes.Length with 0<br>0000000d jle 0000002A                   // if bytes.Length &lt;=0, go to 2a<br>0000000f mov ecx,dword ptr [ebx+4]      // ecx = m_textWriter (field)<br>00000012 cmp edi,dword ptr [esi+4]      // compare x with bytes.Length<br>00000015 jae 0000002E                   // if x &gt;= bytes.Length, go to 2e<br>00000017 movzx edx,byte ptr [esi+edi+8] // edx = bytes[x]<br>0000001c mov eax,dword ptr [ecx]        // eax = m_textWriter’s type object<br>0000001e call dword ptr [eax+000000BCh] // Call m_textWriter’s write method<br>00000024 inc edi                        // x++<br>00000025 cmp dword ptr [esi+4],edi      // compare bytes.Length with x<br>00000028 jg 0000000F                    // if bytes.Length &gt; x, go to f<br>0000002a pop ebx                        // Epilog<br>0000002b pop esi<br>0000002c pop edi<br>0000002d ret                            // return to caller<br>0000002e call 76B6E337                  // Throw IndexOutOfRangeException<br>00000033 int 3                          // Break in debugger<br>Figure 20-2 Native code produced by the JIT compiler with ranges of roots shown</p>
<p>As the JIT compiler produces the native code, it also creates an internal table. </p>
<p>Logically, each entry in the table indicates a range of byte offsets in the method’s native CPU instructions,<br>and for each range, a set of memory addresses and CPU registers that contain roots.</p>
<p>For the WriteBytes method, this table reflects that the EBX register starts being a root at offset<br>0x00000003, the ESI register starts being a root at offset 0x00000005, and the ECX register<br>starts being a root at offset 0x0000000f. </p>
<p>All three of these registers stop being roots at the end of the loop (offset 0x00000028). </p>
<p>Also note that the EAX register is a root from 0x0000001c to 0x0000001e. </p>
<p>The EDI register is used to hold the Int32 value represented by the variable x in the original source code. </p>
<p>Since Int32 is a value type, the JIT compiler doesn’t consider the EDI register to be a root.</p>
<p>The WriteBytes method is a fairly simple method, and all of the variables that it uses can be enregistered. </p>
<p>A more complex method could use all of the available CPU registers, and some roots would be in memory locations relative to the method’s stack frame. </p>
<p>Also note that on an x86 architecture, the CLR passes the first two arguments to a method via the ECX and EDX registers. </p>
<p>For instance methods, the first argument is the this pointer, which is always passed in the ECX register. </p>
<p>For the WriteBytes method, this is how I know that the this pointer is passed in the ECX register and stored in the EBX register right after the method prolog. </p>
<p>This is also how I know that the bytes argument is passed in the EDX register and stored in the ESI register after the prolog.</p>
<p>If a garbage collection were to start while code was executing at offset 0x00000017 in the WriteBytes method, the garbage collector would know that the objects referred to by the EBX<br>(this argument), ESI (bytes argument), and ECX (the m_textWriter field) registers were all roots and refer to objects in the heap that shouldn’t be considered garbage.</p>
<p>In addition, the garbage collector can walk up the thread’s call stack and determine the roots for all of the calling methods by examining each method’s internal table. </p>
<p>The garbage collector iterates through all the type objects to obtain the set of roots stored in static fields.</p>
<p>When a garbage collection starts, it assumes that all objects in the heap are garbage. </p>
<p>In other words, it is assumed that the thread’s stack contains no variables that refer to objects in the heap, that no CPU registers refer to objects in the heap, and that no static fields refer to objects<br>in the heap. </p>
<p>The garbage collector starts what is called the marking phase of the collection.</p>
<p>This is when the collector walks up the thread’s stack checking all of the roots. </p>
<p>If a root is found to refer to an object, a bit will be turned on in the object’s sync block index field-this is how the object is marked. </p>
<p>For example, the garbage collector might locate a local variable that points to an object in the heap. </p>
<p>Figure 20-3 shows a heap containing several allocated objects, and the application’s roots refer directly to objects A, C, D, and F. </p>
<p>All of these objects are marked. </p>
<p>When marking object D, the garbage collector notices that this object contains a field that refers to object H, causing object H to be marked as well. </p>
<p>The garbage collector continues to walk through all reachable objects recursively.</p>
<p>After a root and the objects referenced by its fields are marked, the garbage collector checks the next root and continues marking objects. </p>
<p>If the garbage collector is going to mark an object that it previously marked, it can stop walking down that path. </p>
<p>This behavior serves two purposes. </p>
<p>First, performance is enhanced significantly because the garbage collector doesn’t walk through a set of objects more than once.<br>Second, infinite loops are prevented if you have any circular linked lists of objects.</p>
<p>Once all of the roots have been checked, the heap contains a set of marked and unmarked objects. </p>
<p>The marked objects are reachable via the application’s code, and the unmarked objects are unreachable. </p>
<p>The unreachable objects are considered garbage, and the memory that they occupy can be reclaimed. </p>
<p>The garbage collector now starts what is called the compact phase of the collection. </p>
<p>This is when the collector traverses the heap linearly looking for contiguous blocks of unmarked (garbage) objects.</p>
<p>If small blocks are found, the garbage collector leaves the blocks alone. </p>
<p>If large free contiguous blocks are found, however, the garbage collector shifts the nongarbage objects down in memory to compact the heap.</p>
<p>Naturally, moving the objects in memory invalidates all variables and CPU registers that contain pointers to the objects. </p>
<p>So the garbage collector must revisit all of the application’s roots and modify them so that each root’s value points to the objects’ new memory location. </p>
<p>In addition, if any object contains a field that refers to another moved object, the garbage collector is responsible for correcting these fields as well. After the heap memory is compacted, the<br>managed heap’s NextObjPtr pointer is set to point to a location just after the last nongarbage object. </p>
<p>Figure 20-4 shows the managed heap after a collection.</p>
<p>As you can see, a garbage collection generates a considerable performance hit, which is the major downside of using a managed heap. </p>
<p>But keep in mind that garbage collections occur only when generation 0 is full, and until then, the managed heap is significantly faster than a C-runtime heap. </p>
<p>Finally, the CLR’s garbage collector offers some optimizations that greatly improve the performance of garbage collection. </p>
<p>I’ll discuss these optimizations later in this chapter, in the “Generations” and “Other Garbage Collector Performance Topics” sections.</p>
<p>As a programmer, you should take away a couple of important points from this discussion.</p>
<p>To start, you no longer have to implement any code to manage the lifetime of objects your application uses. </p>
<p>And notice how the two bugs described at the beginning of this chapter no longer exist. </p>
<p>First, it’s not possible to leak objects because any object not accessible from your application’s roots can be collected at some point.<br>Second, it’s not possible to access an object that is freed because the object won’t be freed if it is reachable, and if it’s not reachable, your application has no way to access it. </p>
<p>Also, since a collection causes memory compaction, it is not possible for managed objects to fragment your process’ virtual address space. </p>
<p>This would sometimes be a severe problem with unmanaged heaps but is no longer an issue when using the managed heap. </p>
<p>Using large objects (discussed later in this chapter) is an exception to this, and fragmentation of the large object heap is possible.</p>
<p>Note:</p>
<p>If garbage collection is so great, you might be wondering why it isn’t in ANSI C++. </p>
<p>The reason is that a garbage collector must be able to identify an application’s roots and must also be able to find all object pointers. </p>
<p>The problem with unmanaged C++ is that it allows casting a pointer from one type to another, and there’s no way to know what a pointer refers to. </p>
<p>In the CLR, the managed heap always knows the actual type of an object and uses the metadata information to determine which members of an object refer to other objects.</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">&laquo;</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/">&raquo;</a>
  </nav>

 </div>

        

        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="css/images/1035498.gif" alt="Chandler" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Chandler</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Chandler's Blog</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">34</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">categories</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">28</span>
              <span class="site-state-item-name">tags</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chandler</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    
    

  


  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
